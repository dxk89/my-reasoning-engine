# render.yaml

# This Render configuration defines a single web service for the
# my‑reasoning‑engine application.  It installs Google Chrome into
# Render’s persistent storage during the build step so that Selenium
# can locate a browser binary at runtime.  The start command adds
# Chrome’s location to the PATH and then launches the application via
# uvicorn.

services:
  - type: web
    name: my-reasoning-engine
    env: python
    plan: free
    # Install Chrome and dependencies before running pip install.
    # The render-build.sh script will download Google Chrome into the
    # persistent storage directory (.render/chrome) and cache it so
    # subsequent builds are faster.
    buildCommand: |
      # Install Chrome into persistent storage if not already cached
      bash render-build.sh
      # Install Python dependencies
      pip install -r requirements.txt
    # Prepend Chrome’s location to the PATH before launching the app.
    # We set GOOGLE_CHROME_BIN to the portable Chrome binary extracted
    # during the build step.  We also extend the PATH so that
    # webdriver-manager and other tooling can locate the executable.
    # uvicorn is used here to run the FastAPI application defined in
    # app.server.
    startCommand: |
      # Point Selenium to the installed Chrome binary and ensure it is in PATH.
      export GOOGLE_CHROME_BIN="/opt/render/project/.render/chrome/chrome-linux64/chrome"
      export PATH="${PATH}:/opt/render/project/.render/chrome/chrome-linux64"
      # Launch the FastAPI app via uvicorn
      uvicorn app.server:app --host 0.0.0.0 --port $PORT
    envVars:
      - key: OPENAI_API_KEY
        sync: false
      - key: PYTHON_VERSION
        value: "3.11"
      - key: PYTHONPATH
        value: src