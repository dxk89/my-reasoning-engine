services:
  - type: web
    name: my-flask-app
    env: python
    plan: free
    buildCommand: |
      bash render-build.sh
    startCommand: |
      # Read the Chrome binary path from the file saved during build
      CHROME_BIN=$(cat /opt/render/project/.render/.render-chrome-path)
      if [ -z "$CHROME_BIN" ]; then
        echo "Chrome binary path not found in .render-chrome-path" >&2
        exit 1
      fi
      export GOOGLE_CHROME_BIN="$CHROME_BIN"
      export PATH="$PATH:$(dirname "$CHROME_BIN")"
      
      # Set the ChromeDriver path
      CHROME_DRIVER="/opt/render/project/.render/chromedriver/chromedriver"
      if [ -f "$CHROME_DRIVER" ]; then
        export CHROMEDRIVER_PATH="$CHROME_DRIVER"
      fi
      
      export RENDER="true"
      gunicorn app.server:app --bind 0.0.0.0:$PORT --timeout 120 --workers 1
    envVars:
      - key: PYTHON_VERSION
        value: 3.11.9